---
title: 'Lab 4: Tidy data in R'
author: "IE 0015"
date: "January 26, 2017"
output:
  pdf_document: default
  html_document: default
---

Note: this lab should be written using R Markdown.  The lab is provided as an R Markdown file for your convenience as a starting point. You should change the author and date appropriately. For the final submission, you should render (Knit) this as either a Word or PDF document and print that output.

In the `tidyr` package there are two Tubeculosis data sets `who` and `population`.  Look at the `tidyr` help files (R Studio -> Packages tab -> tidyr) to see what each contains. To load and view the last few rows of the datasets, you should enter:

```{r, warning=FALSE}
library(tidyverse)
data(who)
tail(who)
```
```{r}
data(population)
tail(population)
```

1. [3] Look the `who` file (which has cases by age), what represents a single observation?  What makes the `who` dataset NOT comply with the Tidy data rules?  Why do you think this table is organized the way it is?

**ANSWER**

A single observation is the number of cases within a specific age range in a single country in a single year.

Each row in the who dataset has several values that refer to different populations (age ranges). Tidy data, each row is a single observation.

The data is organized so that the reader can see all information about a country and year in a single row.

2. [4]  What steps need to be taken make the who data tidy? Do so using R and save the results to the data frame `tidywho`. (note: you may leave the labels as they are, you do not have to rewrite the age ranges)  Display the last 10 rows.

To save effort, only use the variables corresponding to new positive pulmonary smears.

Note, your first line should select the columns that you are interested in. Hint: do your work with only two or three columns. After you get it working, add in the other columns.

```{r}
who_new_sp <- who[,c("country", "iso2", "iso3", "year", "new_sp_m014",  "new_sp_m1524","new_sp_m2534", "new_sp_m3544", "new_sp_m4554", "new_sp_m5564", "new_sp_m65", "new_sp_f014", "new_sp_f1524", "new_sp_f2534", "new_sp_f3544", "new_sp_f4554", "new_sp_f5564", "new_sp_f65")]
```
**ANSWER**
Gather. From each row, take each value, and create a row with the country, year, age range, and value.

```{r}
tidywho <- who_new_sp %>% gather(`new_sp_m014`,  `new_sp_m1524`, `new_sp_m2534`, `new_sp_m3544`, `new_sp_m4554`, `new_sp_m5564`, `new_sp_m65`,   `new_sp_f014`, `new_sp_f1524`, `new_sp_f2534`, `new_sp_f3544`, `new_sp_f4554`, `new_sp_f5564`, `new_sp_f65`, key = "agerange", value="cases")
tidywho %>% tail(10)  
```

3. [3] Using the original WHO data, use the `who` and `population` tables together to create a table with the name of the country, iso3, year and population.  Display the last 6 rows of the table (which should be Zimbabwe). Hint: draw a process map to understand what you need to do, then work on one step at a time, and feed the result to the next step.


**ANSWER**
```{r}
whopop <- who %>% 
  left_join(population) %>%
    select(country, iso3, year, population) 
whopop %>% tail()
```