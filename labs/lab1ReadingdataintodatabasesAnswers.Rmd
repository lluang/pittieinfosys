---
title: "Reading data into databases"
author: "IE0015 Lab 1"
date: "January 10/11, 2019"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---

Note: This lab should be done as a Word file so you can cut and paste MS Access output to answer questions as needed.  When a query is required, you may use the MS Access Query Wizard to design the query, then use the SQL View to display the resulting SQL that will go into your answer. 

1. [1] Download the Affiliate data from Courseweb (My Documents -> Data Sets) and look at it using a text editor (Notepad or the R Studio editor). 

What character separates fields in this file?  What character identifies text that should be kept in the same data field? (Note: only some records need to especially identify text, what distinguishes them) What would happen if you did not identify text that should be kept together?

**ANSWER**

comma, "", If there is punctuation in the address, it will be broken into two columns.


2. [1]  Using the MS Access, import the Affiliate list data using default settings. How many rows and columns are in the resulting table?  

**ANSWER**
14844 rows. If off by one, check that field names are headers.
10 columns.  Can be 11 columns if an index column is created.


3. [1]  Using default settings, for several records the data fields are in the wrong column.  What causes this error?  Re-import the Affiliate list and set the options so this is done correctly.  Set the Affiliate ID to be the primary key.

**ANSWER**
Some of the records have an extra fields, so fields beginning with the City are in the wrong column.  Need to identify the double quote \" character as text delimiter to keep the address from being split across two fields.  Especitally when there is a suite number as part of the address.

4. [1]  Look at the Women 2017 Rx dataset in a text editor. Import the Women 2017 Rx dataset.  Set the UserID to be the primary key. Check that the field types make sense. Allow for duplicates.  What happened to the column names?

**ANSWER** 
You should notice that the periods (.) in the column names disappeared.

5. [2]  Load in the remainder of the data files (Women 2018 Rx, Men 2017 Rx, Men 2018 Rx).  Check for import errors.  What import errors were there?  Find the errors in the original CSV file (import in Excel).  Lookup the workout on google (search for CrossFit Open (year)) and explain the error in terms of the workout.

**ANSWER**
There were scores that were in days minutes hours format while most scores were in seconds.

For problems 5 and 6, you will do the lab based on your last name and your birth month.

Last (family) name:  A-L: Women,  M-Z: Men
Birth month:  Jan - June:  2017,  July-December: 2018

5. [1]  The final result of the CrossFit Open is the sum of the ranks.  Modify the table design that calculates the sum of the ranks of athletes in your dataset, then sort the athletes by rank.  Confirm that this gives the same results as the field "Overall rank"

Write how you modified the table design (include a copy and paste of the equation) and copy and paste in a table that shows the correct result.


6. [3]  Create a query that does the following:

    i. For each affiliate (gym), identify the number of athletes who entered the CrossFit Open that year.
    ii.  What is the minimum (best) sum of ranks for that affiliate.
    iii.  What is the maximum (worst) sum of ranks for that affiliate.
    
Select SQL View and copy and paste the results of the SQL view.  Also submit a table (copy and paste into word) with the top 10 affiliates, sorted by the number of athletes entered.



SELECT Affiliate_list.[Affiliate_id], Affiliate_list.[Affiliate_name], Affiliate_list.[State], Affiliate_list.[Country], Count(Women_Rx_2017.Userid) AS CountOfUserid, Min(Women_Rx_2017.Overallrank) AS MinOfOverallrank, Max(Women_Rx_2017.Overallrank) AS MaxOfOverallrank
FROM Affiliate_list INNER JOIN Women_Rx_2017 ON Affiliate_list.Affiliate_id = Women_Rx_2017.Affiliateid
GROUP BY Affiliate_list.[Affiliate_id], Affiliate_list.[Affiliate_name], Affiliate_list.[State], Affiliate_list.[Country]
ORDER BY Count(Women_Rx_2017.Userid) DESC;
