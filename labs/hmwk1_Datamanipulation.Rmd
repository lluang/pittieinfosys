---
title: 'Homework 1: Data manipulation'
author: "IE 0015"
date: "February 15, 2017"
output:
  html_document: default
  pdf_document: default
---

For the homework assignments, code and narrative should be written using R Markdown.  Process maps can be written on separate pieces of paper. You should render the R Markdown as PDF or Word, print the output, and staple with the process maps for the complete submission.

In the `tidyr` package there are two Tubeculosis data sets `who` and `population` (you used them in Lab 3).  Look at the `tidyr` help files (R Studio -> Packages tab -> tidyr) to see what each contains. To load and view the last few rows of the datasets, you should enter:

```{r, warning=FALSE}
library(tidyverse)
data(who)
tail(who)
```
```{r}
data(population)
tail(population)
```

1. Look the `who` and `population` data sets from the `tidyr` package (the information files are in the `tidyr` package help files).  Make the `who` dataset tidy data (Note: see lab 3) with the following columns:  Country, iso2, year, subgroup, cases.  For `subgroup`, the value should be what are currently column headings. (in lab 3 you used `agerange`)


```{r}
who_new_sp <- who[,c("country", "iso2", "iso3", "year", "new_sp_m014",  "new_sp_m1524","new_sp_m2534", "new_sp_m3544", "new_sp_m4554", "new_sp_m5564", "new_sp_m65", "new_sp_f014", "new_sp_f1524", "new_sp_f2534", "new_sp_f3544", "new_sp_f4554", "new_sp_f5564", "new_sp_f65",  
"new_sn_m014",  "new_sn_m1524", "new_sn_m2534", "new_sn_m3544", "new_sn_m4554", "new_sn_m5564","new_sn_m65",   "new_sn_f014",  "new_sn_f1524", "new_sn_f2534", "new_sn_f3544", "new_sn_f4554","new_sn_f5564", "new_sn_f65",   
"new_ep_m014",  "new_ep_m1524", "new_ep_m2534", "new_ep_m3544","new_ep_m4554", "new_ep_m5564", "new_ep_m65",   "new_ep_f014",  "new_ep_f1524", "new_ep_f2534","new_ep_f3544", "new_ep_f4554", "new_ep_f5564", "new_ep_f65",   
"newrel_m014",  "newrel_m1524","newrel_m2534", "newrel_m3544", "newrel_m4554", "newrel_m5564", "newrel_m65",   "newrel_f014","newrel_f1524", "newrel_f2534", "newrel_f3544", "newrel_f4554", "newrel_f5564", "newrel_f65")]
```


```{r}
tidywho <- who_new_sp %>% gather(`new_sp_m014`,  `new_sp_m1524`, `new_sp_m2534`, `new_sp_m3544`, `new_sp_m4554`, `new_sp_m5564`, `new_sp_m65`,   `new_sp_f014`, `new_sp_f1524`, `new_sp_f2534`, `new_sp_f3544`, `new_sp_f4554`, `new_sp_f5564`, `new_sp_f65`, 
`new_sn_m014`,  `new_sn_m1524`, `new_sn_m2534`, `new_sn_m3544`, `new_sn_m4554`, `new_sn_m5564`,`new_sn_m65`,   `new_sn_f014`,  `new_sn_f1524`, `new_sn_f2534`, `new_sn_f3544`, `new_sn_f4554`,`new_sn_f5564`, `new_sn_f65`,   
`new_ep_m014`,  `new_ep_m1524`, `new_ep_m2534`, `new_ep_m3544`,`new_ep_m4554`, `new_ep_m5564`, `new_ep_m65`,   `new_ep_f014`,  `new_ep_f1524`, `new_ep_f2534`,`new_ep_f3544`, `new_ep_f4554`, `new_ep_f5564`, `new_ep_f65`,   
`newrel_m014`,  `newrel_m1524`,`newrel_m2534`, `newrel_m3544`, `newrel_m4554`, `newrel_m5564`, `newrel_m65`,   `newrel_f014`,`newrel_f1524`, `newrel_f2534`, `newrel_f3544`, `newrel_f4554`, `newrel_f5564`, `newrel_f65`,
key = "subgroup", value="cases")
tidywho %>% tail(10)  
```

2.  In the subgroup column, there are actually three pieces information: the mode of diagnosis,  gender, and the age range.
  a. Draw a process map for the steps to take to extract age range, diagnosis mode, and gender from the original column names. Note: in a process map, each function in (b) should correspond to a block on the process map.
  b. In R, create three new columns 'agerange', 'gender', 'diagnosismode' and populate them based on the current value of subgroup. (note: 'agerange' is going to be the hardest of the three, I suggest starting with 'gender'). Print out the last 6 rows of Country, iso3, year, agerange, gender, diagnosismode, cases.


3.  You want to calculate the rate of cases per 100,000 population.  
  a. Draw a process map that takes your modified who table and the population table to end up with a table with: Country, iso3, year, total cases, population, cases per 100,000
  b. Implement the method from your process map. Print out the last 6 rows of the table.
  
4.  You need a table of rates of annual diagnosis by country.
  a. Draw a process map that creates a table with the the rate (per 100,000) of new diagnosis for each country for each year by diagnosis mode. Note: it this table should be tidy.
  b. Implement the procedure, then 

3. [3] Using the original WHO data, use the `who` and `population` tables together to create a table with the name of the country, iso3, year and population.  Display the last 6 rows of the table (which should be Zimbabwe). Hint: draw a process map to understand what you need to do, then work on one step at a time, and feed the result to the next step.


**ANSWER**
```{r}
who %>% 
  left_join(population) %>%
    select(country, iso3, year, population) %>%
      tail()

```