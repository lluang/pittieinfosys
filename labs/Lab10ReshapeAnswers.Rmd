---
title: 'Lab 10:  Reshape and Split-Apply-Combine'
author: "IE 0015 Information Systems Engineering"
date: "March 2016"
output: pdf_document
---

```{r loadlibraries, warning=FALSE}
library(reshape2)
library(plyr)
library(ggplot2)
FemPreg <- read.csv("../data/2006_2010_FemPreg.csv",
                    header=TRUE, sep=",")
FemPreg$HIEDUC <- as.ordered(FemPreg$HIEDUC)
```


# 1. Recode data (2pts)

In the National Survey of Family Growth (NSFG), the highest level of education achieved by the mother is identified in the variable `HIEDUC`.  Create a variable `education` that contains the text value of the meaning behind `HIEDUC`.

ANSWER
------

```{r}
# level of education
education <- data.frame(HIEDUC=c("5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15"),
          education= c("9TH GRADE","10TH GRADE",
             "11TH GRADE", "12TH GRADE",
             "HIGH SCHOOL", "SOME COLLEGE",
             "ASSOCIATE", "BACHELOR",
             "MASTER", "DOCTORATE", "PROFESSIONAL DEGREE"))
FemPreg <- merge(FemPreg, education, all.x=TRUE, by='HIEDUC')
```

# 2. Manipulate data (5 pts)

We are interested in looking at the trend in birthweight over time and how education can effect this.  But the birthweight is currently in three sets of columns (for potential triplets).  Create a dataframe with the following columns:
  -  HIEDUC, education,BABYDOB\_Y, BIRTHWGT\_LB, BIRTHWGT\_OZ, birthweight\_oz

Some steps you need to take along the way:  

i.  birthweight\_oz = BIRTHWGT\_LB * 16 + BIRTHWGT\_OZ and needs to be calculated. Remember that you can perform arithmetic operations on vectors.
ii.  remove `NA` and placeholder values from the data.
iii. take the average by year and level of education. (use `ddply` or `aggregate` )

ANSWER
-------

First, create a long data frame. Optional, remove rows with NA for the year (because these also do not have values for birthweight)

```{r}
babyweights1 = data.frame(FemPreg[c('BABYDOB_Y', 'HIEDUC', 'education', 'BIRTHWGT_LB1', 'BIRTHWGT_OZ1')])
babyweights2 = data.frame(FemPreg[c('BABYDOB_Y', 'HIEDUC', 'education', 'BIRTHWGT_LB2', 'BIRTHWGT_OZ2')])
babyweights3 = data.frame(FemPreg[c('BABYDOB_Y', 'HIEDUC', 'education', 'BIRTHWGT_LB3', 'BIRTHWGT_OZ3')])
colnames(babyweights1) = c('BABYDOB_Y', 'HIEDUC', 'education', 'BIRTHWGT_LB', 'BIRTHWGT_OZ')
colnames(babyweights2) = c('BABYDOB_Y', 'HIEDUC', 'education', 'BIRTHWGT_LB', 'BIRTHWGT_OZ')
colnames(babyweights3) = c('BABYDOB_Y', 'HIEDUC', 'education', 'BIRTHWGT_LB', 'BIRTHWGT_OZ')
babyweights = data.frame(rbind(babyweights1, babyweights2, babyweights3))
```

```{r}
babyweights = babyweights[!is.na(babyweights$BABYDOB_Y) & 
                            babyweights$BABYDOB_Y<9998 & 
                            babyweights$BIRTHWGT_LB < 99 & 
                            babyweights$BIRTHWGT_OZ < 99 &
                            !is.na(babyweights$education), ]
```


```{r}
babyweights$birthweight_oz = as.numeric(babyweights$BIRTHWGT_LB) * 16 + as.numeric(babyweights$BIRTHWGT_OZ)
```


```{r}
babyweighthieduc <- aggregate(babyweights$birthweight_oz, by=babyweights[c('BABYDOB_Y', 'education')], FUN=mean)
```


#  3. Plotting multiple groups (3 pts)

Plot the time series of the mean birthweight in ounces for each year with one plot for each level of education (e.g. use `facet_gird(education ~ .)`). Remember to use `ggtitle(), xlab(), ylab()` to provide a title and label your x- and y- axis. Don't worry about the fact that there are too many levels of education to properly analyze the data.

ANSWER
------

```{r}
ggplot(babyweighthieduc)+aes(x=BABYDOB_Y, y=x) + geom_point() + facet_grid(education ~ .) + ggtitle("Mean baby birth weight by level of education over time") + ylab("Mean birth weight in oz") + xlab("Year")

```
