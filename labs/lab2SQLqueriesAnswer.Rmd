---
title: 'Lab 3: SQL Joins'
author: "IE 0015 Information Systems Engineering"
date: "01/21/2015"
output: pdf_document
---

This lab uses the ACS Public Use Microdata Sample (PUMS) data for Pittsburgh (North) (Public Use Microdata Area 01701).  The data dictionary is at 
http://www.census.gov/programs-surveys/acs/technical-documentation/pums/documentation.2012.html

NOTE:  To force a number that is stored as a string to behave like a number, use CAST.

```
SELECT p.SERIALNO, p.AGEP, h.FPARC, h.FES
FROM ss12ppa AS p JOIN ss12hpa as h
ON p.SERIALNO=h.SERIALNO
WHERE cast(p.AGEP as INTEGER) BETWEEN 0 AND 18
AND h.FPARC IN ("1", "2", "3")
AND h.FES IN ("5", "6", "7", "8")
```


1. [1] Determine the fields which identify the number of people in the household, and the type of household ownership (Group Quarter (i.e. dorms, prisons, military barracks), Rental, Own).

ANSWERS

- TEN identifies type of ownership
- NP identifies people in household

2.  [2] Determine the number of people who live in Group Quarters, Rent, Own (include mortgage), or are not currently paying for housing and compare this to the total population (calculate the percent of total of each category, you may calculate this separate from the SQL query).  Include query(ies), the resulting table, and the percentages of people in each category.

```
SELECT TEN, count(SERIALNO), sum(NP) 
FROM ss12hpa
GROUP BY TEN
```

Tenure | Number of households | People in households | Percent total
-----|-----|----|---
"GQ" |   "458"	| "387" | 0.203
"Own(Mortgage)" |	"219"	| "507" | 0.266
"Own (no mortgage)"	| "155"	| "272" | 0.142
"Rent"	| "407"	| "707" | 0.371
"Occupied (no rent)"	| "16"	| "36" | 0.019

1909 people


3.  [3] New York City recently instituted universal Pre-Kindergarden (Pre-school) for four year-olds.  What is the fraction of 4 and 5 year olds in Pre-school in Pittsburgh (North)? 
  a.  What field identifies age of child?
  b.  What field identifies if the child is in school?
  c.  Generate a query that identifies the school status of 4 and 5 year olds. Do not include children in Kindergarden should not be counted (because they have finished eligibility for Pre-school)
  d.  What is the fraction of 4 and 5 year olds are in pre-school? (Note: you will be able to calculate this with the results of part (c))
  
ANSWERS

  a.  p.AGEP where p is ss12ppa
  b.  p.SCH or p.SCHG for which grade
  c.  

```
SELECT count(p.SERIALNO), p.SCHG
FROM ss12ppa AS p 
WHERE cast(p.AGEP as INTEGER) BETWEEN 4 AND 5
AND cast(P.SCHG as INTEGER) < 2
GROUP BY p.SCHG
```

  d.

  14/22
  0.636 (or 63%)

4.  [4] What fraction of pre-school age children (under 6) live in households with a grandparent?
  a.  What field in what table identifies households with children?
  b.  What field in what table identifies if grandparents are living with grandchildren in the household?
  c.  What query determines how many children under 6 are living in a household?
  d.  Determine what fraction of children of pre-school age (under 6) live in households with a grandparent.
  
  
  
ANSWERS

  a.  HUPAC in the household table (=1, 3 if children under 6 present)
  b.  HUGCL in the household table (=1 if grandparents with grandchildren)
  c.  Note that the count has to come from the personal survey table, as the household table only indicates that children are present, not how many. (you could get number of people in the household, but you would not know which ones were children)  
  
```
SELECT count(p.SERIALNO), h.HUGCL
FROM ss12ppa AS p 
JOIN ss12hpa as h
ON p.SERIALNO=h.SERIALNO
WHERE cast(p.AGEP as INTEGER) BETWEEN 0 AND 5
GROUP BY h.HUGCL
```

d.  

Number children under 6 | Grandparents present
---|---
"85" |  "0"
"6"	| "1"

0.066 (or 6.6%)

