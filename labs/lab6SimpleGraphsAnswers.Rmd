---
Title: 'Lab 6: Simple Graphs with ggplot2'
author: "IE 0015 Information Systems"
date: "February 15, 2017"
output:
  html_document: default
  pdf_document: default
---

```{r loadlibraries}
library(ggplot2)
library(dplyr)
```

```{r}
FemPreg <- read.csv("../data/nsfgFemPreg.csv",
                     header=TRUE,sep=",")
```

1.  [4 pts] Read the National Survey of Family Growth Female Pregnancy dataset into R (csv file in CourseWeb -> Course Documents -> Data). Identify the variables that corresponds to the duration of a completed pregnancy in weeks (duration of pregnancy) and the outcome (Pregnancy outcome). Plot three histograms: 

(1)  All live births, 
(2) current pregnancy (pregnancy ongoing at the time of survey), and 
(3) miscarriages. 

Include axis labels and titles (e.g. , `xlab="Pregnancy length", ylab="Number of live births", main="Pregnancy lengths of live births"`).  Give an interpretation of the third histogram (miscarriage). Note that the code book that corresponds to the data we are using (2006-2010) can be found at  http://www.cdc.gov/nchs/nsfg/nsfg_2006_2010_puf.htm Use the NSFG_2006-10_FemPreg_Codebook.

**ANSWER**

```{r}
ggplot(FemPreg[FemPreg$OUTCOME==1,], aes(PRGLNGTH)) + geom_histogram()+xlab("Pregnancy length (weeks)") + ggtitle("Pregnancy length - Live births")
```
```{r}
ggplot(FemPreg[FemPreg$OUTCOME==6,],aes(PRGLNGTH)) + geom_histogram()+xlab("Pregnancy length (weeks)") +ggtitle("Current pregnancy")
```
```{r}
ggplot(FemPreg[FemPreg$OUTCOME==4,],aes(PRGLNGTH)) + geom_histogram() +xlab("Pregnancy length (weeks)") + ggtitle("Miscarriages")
```


Based on the miscarriage histogram, miscarriages tend to occur in the first 20 weeks of the pregnancy.  Don't worry if they say anything in addition to this, but they should at least get this far.

Notes

a. Always attach your R code, or TA will not be able to give you any points if there is difference between your graph and the preferred answer. 
b. "==" is used for comparisons while "=" indicates an assignment. 
c. Field "OUTCOME"(P55 in codebook) most accurately fit the requirement 
  - PREGEND1 (Applicable if pregnancy is a completed pregnancy) is not a full record. In its note it says use record OUTCOME 
  - GESTASUN_W (Applicable if pregnancy is a completed pregnancy (prgoutcome = 1 or 2)) is not a full record either.
  - HOWPREG_N (Applicable if pregnancy is a current pregnancy (prgoutcome = 3)) is also a partial record. It need to be used with HOWPREG_P (Unit) to become a full reply.
  
In all the three fields above, "99"s mean "don't know". If you use those fields (or fields that have similar coding), you need to ensure they are removed from the analysis. See the use of the BIRTHWGHT_LB1 in the answer to the second question for an example.
d. Sorting function "FemPreg[FemPreg$OUTCOME==1,]" means "in the data frame FemPreg, select all the rows that OUTCOME==1, and select all the columns"



2. [6] Plot the relationship between birth weight and birth order.
  a.  What are the variables that represent the birth weight in pounds (1st child of pregnancy) and the birth order?

Ignoring responses where the birth weight was not given (hint: how can you tell) make the following plots. Include axis labels and titles. (e.g. `+ xlab("Pregnancy order") + ylab("Birthweight (lbs)") + ggtitle("Birthweight by pregnancy order")`

  b.  Plot a boxplot of birth weight by pregnancy order (note: convert pregnancy order to a factor using `as.factor()`).
  c.  Plot a jitter plot of birthweight by birth order.
  d.  The jitter plot is hard to read. Set the alpha = 1/5 and plot again. Adjust alpha so that you can see the difference in the density of points. (note: to use jitter and alpha use `geom_jitter(aes(alpha=(1/20)))`)
  e.  Look at the summary of `FemPreg$BIRTHWGT_LB1`  Why are there so many missing values (`NA`) reported when making these plots? (or what did you do to prevent missing values in this plot)
 
**ANSWER**

BIRTHWGHT_LB1 is the birth weight (of a first child born in the case of twins/triplets).
`pregordr` indicates birth order

```{r, echo = FALSE}
birthweightdata <- FemPreg %>% filter(BIRTHWGT_LB1< 99)
ggplot(birthweightdata, aes(factor(pregordr), BIRTHWGT_LB1)) + geom_boxplot()  + xlab("Pregnancy order") + ylab("Birthweight (lbs)") + ggtitle("Birthweight by birth order")
```
```{r}
ggplot(birthweightdata, aes(factor(pregordr), BIRTHWGT_LB1)) + geom_jitter()  + xlab("Pregnancy order") + ylab("Birthweight (lbs)") + ggtitle("Birthweight by birth order - jitter plot")
```

```{r}
ggplot(birthweightdata, aes(factor(pregordr), BIRTHWGT_LB1)) + geom_jitter(aes(alpha=(1/20)))  + xlab("Pregnancy order") + ylab("Birthweight (lbs)") + ggtitle("Birthweight by birth order - jitter plot with alpha")
```


There are a large number of missing values in birthweight because of pregnancies that do not result in live births.

NOTES

a. As a similar problem in Q1, there is several answers not perfectly meet the requirement for the question. Read the full description of the fields before you use them.
BIRTHORD only applicable for all live birth while `pregordr` is applicable for all.
b. Whenever you are not 100% sure about the usage of a function, use command like "?ggplot" or "?as.factor" to get a help page.(add a ? before the command you want to use) It will help you a lot when you have questions about the order or format of function parameters.
c. If you are trying things in the console, remember that in R Studio your code is available in the History tab (2nd tab in right quadrant)