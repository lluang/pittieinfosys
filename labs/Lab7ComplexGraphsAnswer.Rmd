---
title: "Lab 7: Complex graphs"
author: "IE 0015 Information Systems"
date: "February 2018"
output:
  html_document: default
  pdf_document: default
---

```{r loadlibraries, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
library(magrittr)
library(RColorBrewer)
```
```{r, loaddata}
FemPreg <- read.csv("../data/nsfgFemPreg.csv",
                    header=TRUE, sep=",")
```


1.  [5] One question when looking at population demographics is if all parts of the population have the same distribution. 

    a.  Using the Female Pregnancy Data from the National Survey of Population Growth, create graphs that shows the distribution of the birthweight of newborn babies, separated by race (Note: use HISPRACE for this purpose).  Use at least three different type of plots (geom_ or stat_ commands from ggplot, different ways of displaying multiple categories on a single plot).
    b.  Explain which of the three you used is best.

Note: 

  1.  You will need both a way to display distributions, and a way to show each race in a single plot. 
  2.  Race should be identified in the plot as a label, not as a number. (which is how it is presented in the Female Pregnancy data table.)
  3. The code below converts numeric values into their codes (see Lecture 4: Data in R). You will need to something similar later.
  4. Because you are getting distributions by race, you should convert counts into percentages using `y=..density..` within the `aes()` function. 

```{r}
raceorigin <- as.data.frame(
           rbind(c("1", "Hispanic"),
                 c("2", "Non-Hispanic White"),
                 c("3", "Non-HIspanic Black"),
                 c("4", "Non-HIspanic Other"))
           )
colnames(raceorigin) <- c("HISPRACE", "raceorigin")
FemPreg$HISPRACE <- as.factor(FemPreg$HISPRACE)
FemPreg <- FemPreg %>% 
  left_join(raceorigin)
FemPreg$BIRTHWGT_LB1 <- as.numeric(FemPreg$BIRTHWGT_LB1)
FemPreg <- FemPreg %>% filter(BIRTHWGT_LB1<98)
```

**Answer**

Points for 

1. 3 distribution plots (histogram, density)
2. Each plot must show each race separately. (stacked, dodge, facet_wrap, facet_grid)
    a. Optional change y axis to density instead of count.
3. Each plot needs descriptive text and/or legend.
4. They should not choose a density plot (because the birthweight is discrete), but any other answer will be accepted with explanation.

```{r}
FemPreg %>% 
  ggplot(aes(x=BIRTHWGT_LB1, linetype=raceorigin, fill=raceorigin)) + 
  geom_histogram(center=2, bins=10, position="stack") +
  ggtitle("Birthweight distribution by race") +
  scale_fill_brewer(palette="YlGnBu") +
  scale_x_discrete(limits=c(2,12), name="Birthweight (lbs)")
```
```{r}
FemPreg %>% 
  ggplot(aes(x=BIRTHWGT_LB1, y=..density..,  linetype=raceorigin, fill=raceorigin)) + 
  geom_histogram(center = 2, position="dodge", binwidth = 1) +
  ggtitle("Birthweight distribution by race") +
  scale_fill_brewer(palette="YlGnBu") +
  scale_x_discrete(limits=c(2,12), name="Birthweight (lbs)")
```

```{r}
FemPreg %>% 
  ggplot(aes(x=BIRTHWGT_LB1, y=..density..)) + 
  geom_histogram(center=2, bins=10) +
  facet_grid(raceorigin ~ .) +
  ggtitle("Birthweight distribution by race") +
  scale_fill_brewer(palette="YlGnBu") +
  scale_x_discrete(limits=c(2,12), name="Birthweight (lbs)")
```

```{r}
FemPreg %>% 
  ggplot(aes(x=BIRTHWGT_LB1, color=raceorigin)) + 
  geom_density() +
  ggtitle("Density plots birthweight distribution by race") +
  scale_fill_brewer(palette="YlGnBu") +
  scale_x_discrete(limits=c(2,12), name="Birthweight (lbs)")
```


2.  [5] The American Academy of Pediatrics recommends that infants are breastfed exclusively for about the first 6 months and that breastfeeding continue for at least 12 months.  Plot the average duration of breastfeeding (including none) according to both race (HISPRACE) and level of education of the mother (HIEDUC.  Make sure that the plot can be understood when printed in black and white and that the axis names are meaningful and legible. (i.e. translate the numerical values to the descriptions)

    a.  What kind of plot will you choose and why?
    b.  Create the plot using ggplot.  Make sure you have meaningful and legible axis titles.


Notes: 

  1. Use AGEQTNURN1 indicate length of breastfeeding.  
  2. Think about what NA means for this variable.
  3. Aggregations and summaries were covered in Lecture 6: Aggregation


  
```{r}
FemPreg$HIEDUC <- as.ordered(FemPreg$HIEDUC)
highesteducation <- as.data.frame(
                     rbind(c("5", "9TH GRADE OR LESS"),
                            c("6", "10TH GRADE"),
                            c("7", "11TH GRADE"),
                            c("8", "12TH GRADE, NO DIPLOMA (NOR GED)"),
                            c("9", "HIGH SCHOOL GRADUATE (DIPLOMA OR GED)"),
                            c("10", "SOME COLLEGE BUT NO DEGREE"),
                            c("11", "ASSOCIATE DEGREE IN COLLEGE/UNIVERSITY"),
                            c("12", "BACHELOR'S DEGREE"),
                            c("13", "MASTER'S DEGREE"),
                            c("14", "DOCTORATE DEGREE"),
                            c("15", "PROFESSIONAL DEGREE")
                     )
           )
colnames(highesteducation) <- c("HIEDUC", "highesteducation")
highesteducation$HIEDUC <- as.ordered(highesteducation$HIEDUC)
FemPreg <- FemPreg %>% 
  left_join(highesteducation)
```

**ANSWER**

a.  stat_summary_2d (heatmap), because it shows three dimensions where race/origin will be one axis and the education level will be the other axis.  geom_tile works as well

b.  Points for merging summarizing over race and education level, then a summary for average months of breastfeeding. Remember to include `na.rm=True` in the call to `mean()` in `summarize()`, or the summarize function will return NA (and you will have a blank chart).


  
```{r}
breastfeeding <- FemPreg %>% 
                    group_by(raceorigin, highesteducation) %>%
                      summarize(avgmonths = mean(AGEQTNUR1, na.rm=TRUE))
```

                    
```{r}
ggplot(breastfeeding) +
  stat_summary_2d(aes(raceorigin, highesteducation, z=avgmonths)) +
  theme(axis.text.x = element_text(angle=90)) +
  xlab("Race of mother") +
  ylab("Highest level of mother's education") +
  ggtitle("Average months breastfeeding by race and education of mother")
```
```{r}
ggplot(breastfeeding) +
  geom_tile(aes(raceorigin, highesteducation, fill=avgmonths)) +
  theme(axis.text.x = element_text(angle=90)) +
  xlab("Race of mother") +
  ylab("Highest level of mother's education") +
  ggtitle("Average months breastfeeding by race and education of mother")
```