---
title: 'Lab 3:  Aggregation'
author: "IE 0015 Information Systems Engineering"
date: "January 23/24, 2020"
output:
  html_document: default
  pdf_document: default
---


Load the data set from the National Survey of Family Growth from CourseWeb. (i.e. download the data and modify the below read_csv function call appropriately)
```{r loadlibraries, warning=FALSE}
library(dplyr)
library(readr)
library(magrittr)
# NSFG data in Courseweb
FemPreg <- read_csv("../data/nsfgFemPreg.csv",
                    col_names=TRUE)
FemPreg$BIRTHORD <- as.factor(FemPreg$BIRTHORD)
FemPreg$PRGLNGTH <- as.integer(FemPreg$PRGLNGTH)
```

```{r}
# level of education
education <- data.frame(
          HIEDUC=c(5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15),
          education = c("9TH GRADE","10TH GRADE",
             "11TH GRADE", "12TH GRADE",
             "HIGH SCHOOL", "SOME COLLEGE",
             "ASSOCIATE", "BACHELOR",
             "MASTER", "DOCTORATE", "PROFESSIONAL DEGREE"))
# informal marital status
marital <- data.frame(RMARITAL=c(1, 2, 3, 4, 5, 6),
                      marital = c("MARRIED",
                                 "LIVING WITH PARTNER",
                                 "WIDOWED",
                                 "DIVORCED",
                                 "SEPARATED",
                                 "NEVER BEEN MARRIED"))
```

1. [2] The HIEDUC and RMARITAL fields currently have codes.  The `education` and `marital` data frames contain the definitions behind those codes based on the NSFG code book.  Use `left_join` to add a columns to `FemPreg` to include the actual values of level of education and marital status.

**ANSWER**

```{r}
FemPreg <- FemPreg %>% left_join(education, by = "HIEDUC")

FemPreg <- FemPreg %>% left_join(marital, by="RMARITAL")
```

2. [2]  Using the female pregnancy data, create a table  that shows the distribution of respondents by level of education. Note that there is more than one way to approach this.  Use the dplyr functions.


**ANSWER**
```{r}
FemPreg %>% group_by(education) %>%
  summarize(count=n())
```

alternative solutions:
```{r}
as.data.frame(table(FemPreg$education))
edu<-FemPreg$education
edudf<-as.data.frame(summary(edu))

as.data.frame(summary(subset(FemPreg,select=c("education"))))
```

3. [3]  Find the mean of number of weeks of breastfeeding  by level of education of the mother. (Note that the code above merges the ACS coded level of education with its meaning.) 
  i.  Create a data frame that only includes women who have completed breastfeeding (hint: remove those for which are not applicable, still breastfeed, or never breastfeed based on the BFEEDWKS field, a '!' indicates  The Female pregnancy data codebook identifies the codes used in the `BFEEDWKS` variable.)
  ii.  Create a table that reports the mean number of weeks of breastfeeding by level of education (of mother) 


**ANSWER**
```{r}
FemPreg %>% filter(!BFEEDWKS %in% c(NA, 994, 995)) %>%
  group_by(education) %>%
    summarise(avgweeks = mean(BFEEDWKS))
```

Alternative solutions:

```{r}
completebf <- FemPreg[!(FemPreg$BFEEDWKS %in% c(NA, 994, 995)),]
completebf$BFEEDWKS <- as.numeric(completebf$BFEEDWKS)
aggregate(completebf[,c('BFEEDWKS')],by=list(completebf$education),mean,na.rm=TRUE)
```
```{r}
# tapply mostly works on vector, so it will need two lines, each for one vector. 
tapply(completebf$BFEEDWKS,completebf$education,mean)
```

4. [3] Breastfeeding compared to education and marital status

  i. Find the average number of weeks of breastfeeding based on education and informal marital status (`education` and `marital`).

  ii.  The U.S. Centers for Disease Control and Prevention (CDC) and the American Academy of Pediatrics (AAP) recommend that infants be exclusively breastfed for the first six months and they continue to breastfeed along with complementary food for 1 year or longer.  The World Health Organization (WHO) recommends exclusive breastfeeding for six months along with complementary foods up to 2 years of age or longer. Comment on your results over this entire assignment (3 and 4) in light of these recommendations.
  
Note: remember that to ignore 'NA' in the mean, use the option `na.rm=TRUE`  e.g. `mean(vector, na.rm=TRUE)`

**ANSWER**
```{r}
completebf %>% group_by(education, marital) %>%
  summarise(avgweeks=mean(BFEEDWKS, na.rm=TRUE))
```

For the discussion, most should be based on the answer for question 3. Higher education generally corresponds to higher number of weeks of breastfeeding. It would be difficult to say something about marital status, but living with partner seems to lead to low breastfeeding compared to other types of marital status.  For this grade loosely, pretty much anything is acceptable.  Note that this question provides evidence for plagerism if it is a direct copy.

**Alternative**

```{r, warnings=FALSE}
aggregate(completebf[,c('BFEEDWKS')],by=list(completebf$education, completebf$marital),mean,na.rm=TRUE)
```


Remark:   
1) When there is Error message like "Error: could not find function "cast" ", possible reason is that you haven't 
loaded the library or haven't installed it. Installing or loading the library should fix the problem.       
