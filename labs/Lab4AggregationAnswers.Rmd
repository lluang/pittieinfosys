---
title: 'Lab 4:  Aggregation'
author: "IE 0015 Information Systems Engineering"
date: "February 1/2, 2018"
output:
  html_document: default
  pdf_document: default
---

```{r loadlibraries, warning=FALSE}
library(dplyr)
library(magrittr)
# NSFG data in Courseweb
FemPreg <- read.csv("../data/nsfgFemPreg.csv",
                    header=TRUE, sep=",")
FemPreg$BIRTHORD <- as.factor(FemPreg$BIRTHORD)
FemPreg$PRGLNGTH <- as.integer(FemPreg$PRGLNGTH)
```

```{r}
# level of education
education <- data.frame(
          HIEDUC=c(5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15),
          education = c("9TH GRADE","10TH GRADE",
             "11TH GRADE", "12TH GRADE",
             "HIGH SCHOOL", "SOME COLLEGE",
             "ASSOCIATE", "BACHELOR",
             "MASTER", "DOCTORATE", "PROFESSIONAL DEGREE"))
# informal marital status
FemPreg <- FemPreg %>% left_join(education, by = "HIEDUC")
marital <- data.frame(RMARITAL=c(1, 2, 3, 4, 5, 6),
                      marital = c("MARRIED",
                                 "LIVING WITH PARTNER",
                                 "WIDOWED",
                                 "DIVORCED",
                                 "SEPARATED",
                                 "NEVER BEEN MARRIED"))
FemPreg <- FemPreg %>% left_join(marital, by="RMARITAL")
```

1.[3]  Using the female pregnancy data, create a table  that shows the distribution of respondents by level of education. Note that there is more than one way to approach this.  Think dplyr functions. (Note that the above code takes ACS data and replaces the education code with the meaning of the code, similar to the aggegation code in lecture.)


## ANSWER
```{r}
FemPreg %>% group_by(education) %>%
  summarize(count=n())
```

# alternative solutions:
```{r}
as.data.frame(table(FemPreg$education))
edu<-FemPreg$education
edudf<-as.data.frame(summary(edu))

as.data.frame(summary(subset(FemPreg,select=c("education"))))
```

2.[4]  Find the mean of number of weeks of breastfeeding  by level of education of the mother. (Note that the code above merges the ACS coded level of education with its meaning.) 
  i.  Create a data frame that only includes women who have completed breastfeeding (hint: remove those for which are not applicable, still breastfeed, or never breastfeed based on the BFEEDWKS field, use the `!(FemPreg$BFEEDWKS %in% c( . . .))` to select from the data frame. The Female pregnancy data codebook identifies the codes used in the `BFEEDWKS` variable.)
  ii.  Take the mean number of weeks of breastfeeding by education (of mother) 

## ANSWER
```{r}
filter(FemPreg, !BFEEDWKS %in% c(NA, 994, 995)) %>%
  group_by(education) %>%
    summarise(avgweeks = mean(BFEEDWKS))
```

# Alternative solutions:

```{r}
completebf <- FemPreg[!(FemPreg$BFEEDWKS %in% c(NA, 994, 995)),]
completebf$BFEEDWKS <- as.numeric(completebf$BFEEDWKS)
aggregate(completebf[,c('BFEEDWKS')],by=list(completebf$education),mean,na.rm=TRUE)
```
```{r}
# tapply mostly works on vector, so it will need two lines, each for one vector. 
tapply(completebf$BFEEDWKS,completebf$education,mean)
```

3.[3]  Find the average number of weeks of breastfeeding and weeks of maternity leave based on education and informal marital status (`education` and `marital`). Note: remember that to ignore 'NA' in the mean, use the option `na.rm=TRUE`  e.g. `mean(vector, na.rm=TRUE)`

## ANSWER
```{r}
completebf %>% group_by(education, marital) %>%
  summarise(avgweeks=mean(BFEEDWKS, na.rm=TRUE))
```

**Alternative**

```{r, warnings=FALSE}
aggregate(completebf[,c('BFEEDWKS')],by=list(completebf$education, completebf$marital),mean,na.rm=TRUE)
```


Remark:   
1) When there is Error message like "Error: could not find function "cast" ", possible reason is that you haven't 
loaded the library or haven't installed it. Installing or loading the library should fix the problem.       
