---
title: 'Lab 12: Simulation'
author: "IE 0015"
date: "April 14, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Monte Carlo simulation

You want to using Monte Carlo simulation to find the volume of an ellipsoid defined by:

$$\frac{x^2}{4^2} + \frac{y^2}{6^2} + \frac{z^2}{3^2}=1$$

a.  What are the values of three semi-principle axis of the ellipsoid? (the distance from the center to the edges that )
b.  Define a 3-d rectangular box that completely encloses the ellipsoid.  Find the volume of that box.
c.  Write a simulation that uses Monte Carlo to estimate the volume of the ellipsoid.
d.  Run the simulation for 10,000 iterations 10 times (i.e. find 10 estimates of the volume)
e.  Calculate the 95% confidence interval of the volume. (Note: see section 8.1 of *Introduction to R* in the Help section. The function you need is qt). You may have to reference your IE 1071 book/notes or the IPSUR book (from the ISPUR package).

**ANSWER**
a. Axis are 4, 6, 3
b. Ellipsoid is inside the box formed by x from -4 to 4, y from -6 to 6, z from -3 to 3. Note that the total volume is 8 * 12 * 3 =388
c. 

```{r}
reps = 10
maxx = 4
maxy = 6
maxz = 3
ellipsevolume <- function(a, b, c){
  boxvolume = 2*a * 2 *b * 2*c
  maxi = 10000
  x <- runif(maxi, min = -a, max = a)
  y <- runif(maxi, min = -b, max = b)
  z <- runif(maxi, min = -c, max = c)
  inellipse <- ifelse((x^2)/(a^2) + (y^2)/(b^2) + (z^2)/(c^2) <= 1, 1.0, 0.0)
  volume <- mean(inellipse) * boxvolume
  volume
}
```
d.
```{r}
volumeellipse <- replicate(10,ellipsevolume(maxx, maxy, maxz))
volumeellipse
```
e.
```{r}
meanvolume <- mean(volumeellipse)
sdvolume <- sd(volumeellipse)
paste(meanvolume, sdvolume)
```

```{r}
meanvolume + qt(0.975, df=9) * sdvolume/sqrt(10)
meanvolume - qt(0.975, df=9) * sdvolume/sqrt(10)
```
Note: the correct formula for the volume is

$$V = \frac{4}{3} \Pi * A * B * C$$
```{r}
4/3*pi * maxx * maxy * maxz
```

## 2. Hypothesis testing

Assisted Reproductive Technology (ART) is a collection of techniques that help facilityate pregnancy (e.g. in vito fertilization). A 2008 report by the Centers for Disease Control and PRevention estimated that ART has been successful in leading to a live birth in 31\% of cases. A new fertility clinic claims that their success rate is higher than average. A random sample of 30 of their patients yielded a success rate of 40\%. 
A consumer watchdog group would like to determine if this provides strong evidence to support the company's claim.

a.  Write the hypothesis ($H0$ and $HA$) to test if the success rate for ART at this clinic is significantly ghigher than the success rate reported by the CDC.
b.  Write a simulation that models the null hypothesis.
c.  Run the simulation 10,000 times and plot the result.
d.  Estimate the p-value of the clinic's claim and evaluate the hypothesis.


**ANSWER**

In the simulation, sample 30 times where p= 0.31 (the null hypothesis is generated from the general population).
Count the success rate for each sample of 30.
From histogram, find phat = 40
The p-value is the tail probability at phat = 0.40.

```{r}
clinicsim <- function(i){
              successes <- sum(sample(x=0:1, size = 30, replace=TRUE, prob=c((1-0.31), 0.31)))
              return = successes/30
}
clinicresults <-sapply(1:10000, clinicsim)
```

```{r}
hist(clinicresults, breaks = 30)
```

```{r}
print(length(clinicresults[clinicresults>0.40])/length(clinicresults))
```

This is the p-value, so compare this against a target p-value (usually 0.05)