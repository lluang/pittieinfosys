---
title: "Pittsburgh City Trees"
author: "IE 0015 Information Systems"
date: "February 24, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(magrittr)
library(tidyr)
library(ggplot2)
library(readr)
library(stringr)

city_trees_data <- read_csv("city_trees_data.csv",
col_types = cols(`_id` = col_character(),
address_number = col_character(),
id = col_character()))
```


1. The following is a sample of the common names of trees that are in the database. Most people think of trees using the family name (Maple, Poplar, Ash, etc.).  
```{r}
city_trees_data %>% select(common_name) %>%
  unique() %>% arrange(common_name) %>% head()
```

Most people know of tree families, not the name of the specific tree species.  In the following question, ignore "Vacant Site" and "NA" entries for "Common Name".

a.  How is the tree family name set apart form the name of the specific species?
b.  Write a process map that extracts the family name from the common name.
c.  Write a process map that counts the total number of trees by family by named neighborhood.  Remember to remove "Vacant".
d.  Write a process map that makes a list of the top 10 tree family by total count for the city of Pittsburgh. Remember to remove "Vacant".


1. The following are a sample of the scientific names of trees that are in the database. A scientific name has two parts, *genus* and *species*.  Most people would be able to distinguish between two trees of different *genus* visuallyl. Only people with some training in identifying trees would be able to distinguish between different *species* of the same *genus*.

```{r}
city_trees_data %>% select(scientific_name) %>%
  unique() %>% arrange(scientific_name) %>% head()
```

```{r}
city_trees_data <- city_trees_data %>% 
  mutate(family = as.factor(str_split(common_name, pattern = ":", simplify = TRUE)[,1])) %>%
  filter(family != "Vacant Site Small") 
```

```{r}
city_trees_topfamily <- city_trees_data %>%
  group_by(family) %>%
  summarize(count = n()) %>%
  arrange(desc(count)) %>%
  head(10)
```
In the following question, ignore "Vacant Site" and "NA" entries for "scientific name".

a.  How is the tree *genus* set apart form the *species*?
b.  Write a process map that extracts the *genus* from the scientific name.
c.  Write a process map that counts the total number of trees by *genus* by ward. Remember to remove "Vacant".
d.  Write a process map that makes a list of the top 10 tree genus by total count for the city of Pittsburgh. Remember to remove "Vacant".

```{r}
city_trees_data <- city_trees_data %>% 
  mutate(genus = as.factor(str_split(scientific_name, pattern = " ", simplify = TRUE)[,1])) %>%
  filter(genus != "Vacant Site Small") 
```

```{r}
city_trees_topgenus <- city_trees_data %>%
  group_by(genus) %>%
  summarize(count = n()) %>%
  arrange(desc(count)) %>%
  head(6)
```

2.  There are a number of columns that look at the economic value of trees. In particular you want to look at the dollar value of air quality benefits, but separating out the benefits of reducing particulate matter (pm10) (so you cannot use the air_quality_benfits_total_dollar_value field). In addition, you are interested in equity, so you want to see the distribution of value by neighborhood.  Write/draw a process map that accomplishes this.  Note that the first part of the process map should combine the fields that quantify the dollar benefit of air quality from a tree into a single column.


2.  There are a number of columns that look at the economic value of trees. In particular you want to look at total unrealized benefits (i.e. not including property value benefits, so you cannot use the overall_benefits_dollar_value
field). In addition, you are interested in equity, so you want to see the distribution of value by neighborhood.  Write/draw a process map that accomplishes this.  Note that the first part of the process map should combine the fields that quantify the dollar benefit of air quality from a tree into a single column.


3.  Below is a bar graph with the distribution of the six most common tree families in each of the six public works divisions.
    a. Design and sketch a visualization that shows:
        i.  Total trees per public works division.
        ii.  Distribution of trees within the public works division.
        iii.  Relative location of public works division.
    b.  Explain how your version of this visualization meets all three criteria and what priority you gave each.
    
```{r, echo=FALSE, warning=FALSE, fig=TRUE}
city_trees_data %>% 
  filter(family %in% city_trees_topfamily$family, !is.na(public_works_division)) %>%
  ggplot() + geom_bar(aes(x=family, fill=as.factor(public_works_division)), position="dodge") +   scale_fill_discrete("Public Works \n Division") + 
  scale_color_brewer("Set3") +
  ggtitle("Common tree families in Pittsburgh by Public Works Division") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))
```

3.  Below is a bar graph with the distribution of the six most common tree families in each of the six public works divisions.
    a. Design and sketch a visualization that shows:
        i.  Total trees per public works division.
        ii.  Distribution of trees within the public works division.
        iii.  Relative location of public works division.
    b.  Explain how your version of this visualization meets all three criteria and what priority you gave each.
    
```{r}
city_trees_data %>% 
  filter(genus %in% city_trees_topgenus$genus, !is.na(public_works_division)) %>%
  ggplot() + geom_bar(aes(x=genus, fill=as.factor(public_works_division))) + 
  scale_color_brewer("Set3") +
  scale_fill_discrete("Public Works \n Division") + 
  ggtitle("Common tree genus in Pittsburgh by Public Works Division") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))
```
