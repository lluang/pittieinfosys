---
title: "ToxicData"
author: "Louis Luangkesorn"
date: "April 17, 2019"
output: html_document
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(magrittr)
library(tidyr)
library(stringr)
library(lubridate)
library(ggplot2)
library(readr)
library(broom)
library(openintro)

```
```{r, error=FALSE, message=FALSE, echo=FALSE, warning=FALSE}
#datadirectory <- "E:/Box Sync/courses/InfoSystems/infosysSP2019/"
datadirectory <- "C:/Users/louis/Desktop/Box Sync/courses/InfoSystems/infosysSP2019/"

toxics <- read_csv(file.path(datadirectory,"toxics-release-inventory-pennsylvania-1987-2015.csv"),
col_types = cols(`8.8_ONE-TIME_RELEASE` = col_double(),
`8.9_PRODUCTION_RATIO` = col_double(),
CITY = col_double(), DOC_CTRL_NUM = col_character(),
FRS_ID = col_character(), NAICS_2 = col_skip(),
CITY = col_skip(),
NAICS_3 = col_skip(), NAICS_4 = col_skip(),
NAICS_5 = col_skip(), NAICS_6 = col_skip(),
PARENT_COMPANY_DB_NUMBER = col_character(),
PRIMARY_SIC = col_skip(), SIC_2 = col_skip(),
SIC_3 = col_skip(), SIC_4 = col_skip(),
SIC_5 = col_skip(), SIC_6 = col_skip(),
SRS_ID = col_character(), ZIP = col_character()))

toxicallegheny <- toxics %>% filter(COUNTY=="ALLEGHENY")
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
toxicalleghenyyearly <- toxicallegheny %>%
  mutate(TOTAL_RELEASES = (`8.1_RELEASES` + `8.1A_ON-SITE_CONTAINED_REL.`+ `8.1B_ON-SITE_OTHER_RELEASES` +
                                `8.1C_OFF-SITE_CONTAINED_REL.`+`8.1D_OFF-SITE_OTHER_RELEASES`),
         TOTAL_RECOVERY = (`8.2_ENERGY_RECOVERY_ON-SITE`+`8.3_ENERGY_RECOVERY_OFF-SITE`),
         TOTAL_RECYCLE = (`8.4_RECYCLING_ON-SITE`+`8.5_RECYCLING_OFF-SITE`),
         TOTAL_TREATMENT = (`8.6_TREATMENT_ON-SITE`+`8.7_TREATMENT_OFF-SITE`),
         TOTAL_ONE_TIME = (`8.8_ONE-TIME_RELEASE`)) %>%
  group_by(YEAR) %>%
  summarize(Releases = sum(TOTAL_RELEASES, na.rm = TRUE), 
            Energy_recovery = sum(TOTAL_RECOVERY, na.rm = TRUE),
            Recycle = sum(TOTAL_RECYCLE, na.rm = TRUE),
            Treatment = sum(TOTAL_TREATMENT, na.rm = TRUE),
            Onetime = sum(TOTAL_ONE_TIME, na.rm = TRUE))
```


```{r}
ggplot(toxicalleghenyyearly, aes(x=YEAR)) + geom_line(aes(y=Releases), color="black") +
                                       geom_line(aes(y=Energy_recovery), color="blue") +
                                       geom_line(aes(y=Recycle), color="green") +
                                       geom_line(aes(y=Treatment), color="purple") +
                                        geom_line(aes(y=Onetime), color="red")

```


CoNVO 1:  Clean Water Action

*There is growing concern surrounding contamination by per- and polyfluoroalkyl substances (PFAS). The issue blew open in Pennsylvania in 2014 when the chemicals were discovered at unsafe amounts in local drinking water wells in Bucks and Montgomery Counties. The scope of the problem has grown since then with the Pennsylvania Department of Environmental Protection also identifying at least 20 other contamination sites in the state, including two near Pittsburgh at Pittsburgh Air National Guard in Moon Township and Pittsburgh Air Reserve Station in Coraopolis.

PFAS chemicals have been used in consumer products and fire-fighting foam on industrial sites and military bases. Exposure is associated with health impacts including cancer, thyroid disease, ulcerative colitis and birth defects.*

Clean Water Action is interested in the toxic releases in Allegheny County by the chemicals industry (identified through the Industry_Sector field), their forms (release, energy recovery, treatment, recycling, identified in 8.x), and locations within Allegheny County.

a. Write a CoNVO statement that covers this.

1. Clean Air Council

The Clean Air Council is a member-supported environmental organization serving the Mid-Atlantic Region. The Council is dedicated to protecting and defending everyone’s right to a healthy environment. The Council works through a broad array of related sustainability and public health initiatives, using public education, community action, government oversight, and enforcement of environmental laws.  They have published the following statement:

*There are a lot of reasons to love Pittsburgh in the center of Allegheny County, but their air pollution is not one of them. Pittsburgh is one of the most up and coming cities in the country but it is also consistently ranked in the top counties for air pollution by the American Lung Association in their State of the Air reports.

In the 2016 State of the Air report, the region landed as the 8th worst in the country for year-round measures on fine particle pollution (or soot), and the 14th worst for short-term particle pollution (the number of days with unhealthy particle levels when air quality is especially dangerous). Pittsburgh also ranked 26th worst in the nation for smog from ground level ozone. Asthma rates for the Pittsburgh region, especially children, exceed the national average and air pollution plays a big role in that.

Pittsburgh has made improvements from the industrial days of the past, but there is still a long way to go before the air is truly clean and safe for all Pittsburghers.

There’s no one single cause to Pittsburgh’s poor air quality. Rather, the region’s legacy as an industrial center has resulted in numerous major sources of air pollution.*

The Clean Air Council wished to depict the major sources of air pollution (Clean Air Act Chemical), their INDUSTRY_SECTOR, location, and how they have changed over the past decade (10 years). (facilities are identfied by TRI_FACILITY_ID and FACILITY_NAME.


a. Write a CoNVO statement that covers this.

PennEnvironment is a statewide, citizen-based environmental advocacy organization. We believe there’s something special about Pennsylvania — something worth protecting and preserving for future generations. 

Much of the industrial air pollution in Pittsburgh’s Allegheny County comes from just 10 industrial facilities that are responsible for 83% of the toxic air pollution reported by industry in the region--They’re known as the Pittsburgh Toxic Ten.

For example, one of the worst offenders is the Shenango Coke Works. This polluting behemoth recently violated its Clean Air Act permits 330 times in a 432 day period—essentially 3 out of every four days.

Many communities located near or downwind from these polluting facilities have been fighting to get them to reduce their pollution and clean up their act for years. 

PennEnvironment is evaluating its strategy that focuses on the top 10 industrial facilities responsible for most of the air pollution in Allegheny County. They want to know if their efforts have led to change over time through changing the quantity of releases compared to other methods of handling waste (energy recovery, treatment or recycling). Note: the field Clean Air Act Chemical identifies toxic substances that effect air pollution.

a.  Write an appropriate CoNVO statement for this.

2.  Baby weight

The Child Health an Development Studies investigate a range of topics. One study considered all pregnancies between 1960 and 1967 among women in the Kaiser Foundation Health Plan in the San Francisco East Bay area. They recorded birthweight (ounces), gestation (length of pregnancy in days), parity (if first born), age (mother's age in years), height (mother's height in inches),  weight (mother's weight in pounds), and smoke (if mother is a smoker).

a. Interpret and compare the two models below: one which looks at `smoke` and one that looks at `parity`

```{r }
babies <- read_csv("C:/Users/louis/Desktop/Box Sync/courses/InfoSystems/os3_data/Ch 8 Exercise Data/babies.csv")
babies <- babies[complete.cases(babies),]
smokelm <- lm(bwt ~ smoke, data=babies)
summary(smokelm)
par(mfrow = c(2,2))
plot(smokelm)
par(mfrow=c(1,1))
```

```{r }
paritylm <- lm(bwt ~ parity, data=babies)
summary(paritylm)

par(mfrow = c(2,2))
plot(paritylm)
par(mfrow=c(1,1))
```

b. You are considering adding one of `gestation`, `age`, `height`, or `weight` to the linear regression model that includes both `smoke` and `parity` from part a. Below is the new linear model and the residual plots based on the candidate variables to be added.  Compare the new model to the models in (a) and comment.

```{r}
babieslm <- lm(bwt ~ smoke + parity, babies)
summary(babieslm)
```

c. Below are the residual plots for the four candidate variables.  For each, explain if you would add this to the model and why.

```{r}
plot(babies$gestation, babieslm$residuals)
```

```{r}
plot(babies$gestation, babieslm$residuals)
```

```{r}
plot(babies$age, babieslm$residuals)
```

```{r}
plot(babies$height, babieslm$residuals)
```

```{r}
plot(babies$weight, babieslm$residuals)
```


3. Prenatal vitamins and autism

Researchers studying the link between prenatal vitamin use and autism surveyed the mothers of a random sample of children aged 24-60 months with autism and conducted another separate random sample for children with typical development. The table below shows the number of mothers in each group who did and did not use prenatal vitamins during the three months before pregnancy.

periconceptual vitamins  |  Autism  | Typical development | total
-----+----------+---------------------+------
No vitamin | 111 | 70 | 181
Vitamin | 143 | 159 | 302 
-----+----------+---------------------+------
Total | 254 | 229  | 302

a.  State appropriate hypthesis to test for independence of the use of prenatal vitamins during the periconceptional period (three months before pregnancy)

b. Present a flowchart that implements bootstrap simulation with 10000 replications to test if using prenatal vitamins during the three months before pregnancy reduces the incidence of autism.  Note: if you need a calculation, you may define a variable to be the result of the calculation for use. e.g. $a=3/4$.  Your answer must include any use of data as well as how a final hypothesis test will be completed.

c.  Below is the result of the hypothesis test in b.  Discuss the conclusion you would draw.  Draw on the diagram as needed. Use a standard of *alpha = 0.05*.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
pautismnone = 111/181
autismsim <- function(i){
              successes <- sum(sample(x=1:0, size = 302, replace=TRUE, prob=c(pautismnone, (1-pautismnone))))
}
autismout <-sapply(1:10000, autismsim)
```


```{r}
hist(autismout, breaks = 100, main = "Distribution of autism in simulation", xlab="Number of instances", xlim=c(120, 230))
```


